{
  "projectName": "Admin Facet Editor",
  "branchName": "feat/admin-facet-editor",
  "description": "Build admin tools for editing mod facets (contentType, visualStyle, themes) both individually and in bulk. Repurpose the categories page for facet definition management.",
  "userStories": [
    {
      "id": "FACET-001",
      "title": "Create Facet Definitions API",
      "description": "Create API endpoints for managing FacetDefinition entries (CRUD operations)",
      "acceptanceCriteria": [
        "Create GET /api/admin/facets - returns all facet definitions grouped by facetType",
        "Create POST /api/admin/facets - creates new facet definition",
        "Create PATCH /api/admin/facets/[id] - updates a facet definition",
        "Create DELETE /api/admin/facets/[id] - deletes a facet definition (only if no mods use it)",
        "GET endpoint returns count of mods using each facet value",
        "All endpoints require admin authentication",
        "npm run type-check passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "API endpoints implemented in app/api/admin/facets/route.ts and app/api/admin/facets/[id]/route.ts"
    },
    {
      "id": "FACET-002",
      "title": "Repurpose Categories page for Facet Definitions",
      "description": "Transform /admin/categories into a Facet Definitions management page",
      "acceptanceCriteria": [
        "Update app/admin/categories/page.tsx to manage FacetDefinition instead of Category",
        "Display facets grouped by facetType (contentType, visualStyle, themes) in tabs or sections",
        "Show for each facet: value, displayName, icon, color, sortOrder, isActive, mod count",
        "Add form to create new facet definition with all fields",
        "Add inline editing for existing facet definitions",
        "Add toggle for isActive status",
        "Add delete button (disabled if mods use this facet)",
        "Update page title and description to reflect Facet Definitions",
        "npm run type-check passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Categories page at app/admin/categories/page.tsx now manages FacetDefinitions with tabs for each facet type"
    },
    {
      "id": "FACET-003",
      "title": "Add facet fields to mod edit form",
      "description": "Update the individual mod edit page to support editing facets",
      "acceptanceCriteria": [
        "Update app/admin/mods/[id]/edit/page.tsx to include facet fields",
        "Add contentType dropdown (single-select) with values from FacetDefinition",
        "Add visualStyle dropdown (single-select) with values from FacetDefinition",
        "Add themes multi-select component with checkboxes or tag picker",
        "Fetch available facet options from /api/admin/facets on page load",
        "Display current facet values when editing existing mod",
        "Save facet values when form is submitted",
        "Update the API endpoint /api/admin/mods/[id] to handle facet updates",
        "Show facet displayNames and colors in the UI for better UX",
        "npm run type-check passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Mod edit page at app/admin/mods/[id]/edit/page.tsx includes all facet fields with multi-select support"
    },
    {
      "id": "FACET-004",
      "title": "Update mods list to show and filter by facets",
      "description": "Replace deprecated category filter with facet filters on the admin mods list",
      "acceptanceCriteria": [
        "Update app/admin/mods/page.tsx to display facets in the table",
        "Add contentType column showing the mod's content type with colored badge",
        "Add visualStyle column or combine with contentType",
        "Replace the category filter dropdown with facet filter dropdowns",
        "Add contentType filter dropdown",
        "Add visualStyle filter dropdown",
        "Add themes filter (multi-select or single theme filter)",
        "Add 'Missing Facets' filter to find mods with null contentType",
        "Update /api/admin/mods to support facet filtering",
        "npm run type-check passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Mods list at app/admin/mods/page.tsx displays facet columns and filter dropdowns; API supports filtering"
    },
    {
      "id": "FACET-005",
      "title": "Build bulk facet edit modal",
      "description": "Create a modal for bulk editing facets on multiple selected mods",
      "acceptanceCriteria": [
        "Add 'Edit Facets' button to bulk actions bar (appears when mods selected)",
        "Create BulkFacetEditModal component",
        "Modal shows: contentType dropdown, visualStyle dropdown, themes multi-select",
        "Each field has three modes: 'No Change', 'Set To', 'Clear'",
        "For themes, add additional mode: 'Add Themes' (merge with existing)",
        "Show count of selected mods in modal header",
        "Preview section shows what will change",
        "Confirm button applies changes to all selected mods",
        "npm run type-check passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "BulkFacetEditModal component implemented in app/admin/mods/page.tsx with all modes"
    },
    {
      "id": "FACET-006",
      "title": "Create bulk facet update API",
      "description": "Create API endpoint for bulk updating facets on multiple mods",
      "acceptanceCriteria": [
        "Create PATCH /api/admin/mods/bulk-facets endpoint",
        "Accept body: { modIds: string[], contentType?: string | null, visualStyle?: string | null, themes?: { mode: 'set' | 'add' | 'clear', values?: string[] } }",
        "Handle 'set' mode: replace themes array",
        "Handle 'add' mode: merge new themes with existing (no duplicates)",
        "Handle 'clear' mode: set themes to empty array",
        "Return count of updated mods",
        "Log bulk operations for audit trail",
        "Require admin authentication",
        "npm run type-check passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Bulk facets API at app/api/admin/mods/bulk-facets/route.ts supports set, add, clear modes"
    },
    {
      "id": "FACET-007",
      "title": "Add quick facet actions to mods table",
      "description": "Add inline quick-edit capabilities for common facet operations",
      "acceptanceCriteria": [
        "Add clickable facet badges in the mods table that open a quick-edit popover",
        "Quick-edit popover for contentType: dropdown to change value",
        "Quick-edit popover for visualStyle: dropdown to change value",
        "Quick-edit popover for themes: checkbox list to add/remove themes",
        "Changes save immediately on selection (optimistic update)",
        "Show loading state while saving",
        "Revert on error with toast notification",
        "npm run type-check passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Quick-edit popovers implemented in app/admin/mods/page.tsx for all facet types"
    },
    {
      "id": "FACET-008",
      "title": "Seed default facet definitions",
      "description": "Create seed script to populate FacetDefinition table with standard values",
      "acceptanceCriteria": [
        "Create scripts/seed-facet-definitions.ts",
        "Seed all contentType values from schema comments with proper displayNames",
        "Seed all visualStyle values with displayNames and colors",
        "Seed all theme values with displayNames, colors, and appropriate icons",
        "Use upsert to avoid duplicates on re-run",
        "Set appropriate sortOrder for logical grouping",
        "Add npm script: db:seed:facets",
        "npm run type-check passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Seed script at scripts/seed-facet-definitions.ts with npm script db:seed:facets"
    },
    {
      "id": "FACET-009",
      "title": "Update admin navigation",
      "description": "Update admin sidebar to reflect new facet management structure",
      "acceptanceCriteria": [
        "Rename 'Categories' nav item to 'Facet Definitions' or 'Taxonomy'",
        "Update icon if needed to better represent facets",
        "Ensure link points to /admin/categories (same URL, new purpose)",
        "Update any breadcrumbs or page references",
        "npm run type-check passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Admin nav updated in app/admin/layout.tsx - Categories renamed to Taxonomy"
    },
    {
      "id": "FACET-010",
      "title": "Integration testing and final polish",
      "description": "Test all facet editing features work together correctly",
      "acceptanceCriteria": [
        "Facet definitions can be created, edited, and viewed",
        "Individual mod facets can be edited and saved",
        "Bulk facet editing works for set, add, and clear modes",
        "Filtering mods by facets works correctly",
        "Missing facets filter shows mods without contentType",
        "Quick-edit popovers work and save correctly",
        "No regression in existing mod functionality",
        "npm run build succeeds",
        "npm run type-check passes",
        "Document any issues in notes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "All features tested - npm run type-check and npm run build pass successfully"
    }
  ]
}
